<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>RedactedCraft VR | Official Site Replica</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script>
      // Professional GPU-level clipping shader
      // Discards any pixel that falls outside the defined Y bounds in world space
      AFRAME.registerShader('ui-clipped', {
        schema: {
          src: {type: 'map', is: 'uniform'},
          opacity: {type: 'number', default: 1, is: 'uniform'},
          minY: {type: 'number', default: -100, is: 'uniform'},
          maxY: {type: 'number', default: 100, is: 'uniform'}
        },
        vertexShader: `
          varying vec2 vUv;
          varying vec3 vWorldPos;
          void main() {
            vUv = uv;
            vWorldPos = (modelMatrix * vec4(position, 1.0)).xyz;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,
        fragmentShader: `
          uniform sampler2D src;
          uniform float opacity;
          uniform float minY;
          uniform float maxY;
          varying vec2 vUv;
          varying vec3 vWorldPos;
          void main() {
            if (vWorldPos.y < minY || vWorldPos.y > maxY) {
              discard;
            }
            vec4 texColor = texture2D(src, vUv);
            gl_FragColor = vec4(texColor.rgb, texColor.a * opacity);
          }
        `
      });

      // Update clipping uniforms every frame
      AFRAME.registerComponent('clip-updater', {
        tick: function () {
          const kiosk = document.getElementById('kiosk');
          if (!kiosk) return;
          
          const kioskPos = new THREE.Vector3();
          kiosk.object3D.getWorldPosition(kioskPos);
          const scale = kiosk.object3D.scale.y;

          // Calculate world-space bounds of the grey backdrop
          const centerY = kioskPos.y - (0.45 * scale);
          const halfHeight = (1.6 * scale); 
          const minY = centerY - halfHeight;
          const maxY = centerY + halfHeight;

          this.el.object3D.traverse((obj) => {
            if (obj.material && obj.material.uniforms) {
              if (obj.material.uniforms.minY) obj.material.uniforms.minY.value = minY;
              if (obj.material.uniforms.maxY) obj.material.uniforms.maxY.value = maxY;
            }
          });
        }
      });

      AFRAME.registerComponent('pixelated', {
        init: function () {
          this.el.addEventListener('materialtextureloaded', (e) => {
            const tex = e.detail.texture;
            tex.magFilter = THREE.NearestFilter;
            tex.minFilter = THREE.NearestFilter;
            tex.needsUpdate = true;
          });
        }
      });

      let scrollY = 0;
      const MAX_SCROLL = 10;
      function applyScroll(dir) {
        scrollY += dir * 0.6;
        scrollY = Math.max(0, Math.min(scrollY, MAX_SCROLL));
        const scroller = document.getElementById('log-scroller');
        if (scroller) scroller.setAttribute('position', `0 ${scrollY} 0`);
      }

      AFRAME.registerComponent('voxel-block', {
        schema: { src: {type: 'map'}, size: {default: 1} },
        init: function () {
          this.el.setAttribute('geometry', { primitive: 'box', width: this.data.size, height: this.data.size, depth: this.data.size });
        },
        update: function () {
          const mesh = this.el.getObject3D('mesh');
          if (!mesh) return;
          const loader = new THREE.TextureLoader();
          loader.load(this.data.src, (texture) => {
            texture.magFilter = THREE.NearestFilter;
            texture.minFilter = THREE.NearestFilter;
            mesh.material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
            const uvAttr = mesh.geometry.attributes.uv;
            const tiles = [{x: 1, y: 0}, {x: 1, y: 1}, {x: 0, y: 0}, {x: 2, y: 0}, {x: 0, y: 1}, {x: 2, y: 1}];
            for (let i = 0; i < 6; i++) {
                const u0 = tiles[i].x / 3, v0 = 1 - (tiles[i].y + 1) / 2, u1 = (tiles[i].x + 1) / 3, v1 = 1 - tiles[i].y / 2;
                const eps = 0.002, su0 = u0 + eps, sv0 = v0 + eps, su1 = u1 - eps, sv1 = v1 - eps;
                const base = i * 4;
                uvAttr.setXY(base, su0, sv1); uvAttr.setXY(base+1, su1, sv1); uvAttr.setXY(base+2, su0, sv0); uvAttr.setXY(base+3, su1, sv0);
            }
            uvAttr.needsUpdate = true;
          });
        }
      });
    </script>
    <style>.a-enter-vr-button { background-color: #4e9a06 !important; }</style>
  </head>
  <body>
    <a-scene renderer="antialias: false; colorManagement: true;">
      <a-assets>
        <img id="logo-img" src="../assets/img/logo.png" crossorigin="anonymous">
        <img id="hero-img" src="../assets/img/hero_bg.png" crossorigin="anonymous">
        <img id="screenshots-bg" src="../assets/img/Screenshots_bg.png" crossorigin="anonymous">
        <img id="profile-bg" src="../assets/img/Profile_bg.png" crossorigin="anonymous">
      </a-assets>

      <a-entity environment="preset: pixel; seed: 42; dressingAmount: 50; grid: dots; groundColor: #1a1a1a; skyColor: #111; horizonColor: #333;"></a-entity>

      <a-entity id="rig" position="0 0 6">
        <a-camera look-controls="pointerLockEnabled: true" wasd-controls>
          <a-cursor color="#4e9a06" fuse="false" raycaster="objects: .clickable"></a-cursor>
          <a-entity class="clickable" id="exit-btn-hud" position="1.6 -0.9 -2" geometry="primitive: plane; width: 0.4; height: 0.15" material="color: #111; opacity: 0.9" onclick="window.location.href='../'">
            <a-text value="EXIT VR" align="center" color="#4e9a06" width="1.2" font="monoid"></a-text>
          </a-entity>
        </a-camera>
        <a-entity laser-controls="hand: left" raycaster="objects: .clickable; far: 10; showLine: true;"></a-entity>
        <a-entity laser-controls="hand: right" raycaster="objects: .clickable; far: 10; showLine: true;"></a-entity>
      </a-entity>

      <a-entity id="kiosk" position="0 2.5 -5" scale="2 2 2">
        <!-- Header -->
        <a-entity id="header-section" position="0 1.9 0.1">
          <a-image src="#hero-img" width="6" height="1.2" position="0 0 -0.05" pixelated material="shader: flat"></a-image>
          <a-plane color="#4e9a06" width="6" height="0.05" position="0 -0.6 0.01"></a-plane>
          <a-image src="#logo-img" width="1.6" height="0.4" position="0 0.1 0.01" pixelated transparent="true" shader="flat"></a-image>
          <a-text value="OFFICIAL DEVELOPER PORTAL" align="center" position="0 -0.2 0.01" color="#fff" width="2.5" font="monoid"></a-text>
        </a-entity>

        <!--Navbar -->
        <a-entity id="navbar-section" position="0 1.25 0.1">
          <a-plane color="#111" width="6" height="0.3" position="0 0 0" material="shader: flat"></a-plane>
          <a-plane color="#3a7304" width="6" height="0.03" position="0 -0.15 0.01"></a-plane>
          <a-entity class="clickable nav-btn" data-target="home" position="-2 0 0.05" geometry="primitive: plane; width: 0.8; height: 0.28" material="color: #4e9a06; shader: flat"><a-text value="HOME" align="center" color="#fff" width="2.2" font="monoid"></a-text></a-entity>
          <a-entity class="clickable nav-btn" data-target="assets" position="-0.7 0 0.05" geometry="primitive: plane; width: 0.9; height: 0.28" material="color: #333; shader: flat"><a-text value="TEXTURES" align="center" color="#fff" width="2.2" font="monoid"></a-text></a-entity>
          <a-entity class="clickable nav-btn" data-target="coding" position="0.7 0 0.05" geometry="primitive: plane; width: 0.9; height: 0.28" material="color: #333; shader: flat"><a-text value="DEV LOG" align="center" color="#fff" width="2.2" font="monoid"></a-text></a-entity>
          <a-entity class="clickable nav-btn" data-target="about" position="2 0 0.05" geometry="primitive: plane; width: 0.8; height: 0.28" material="color: #333; shader: flat"><a-text value="ABOUT" align="center" color="#fff" width="2.2" font="monoid"></a-text></a-entity>
        </a-entity>

        <!-- Content Area -->
        <a-entity id="content-section" position="0 -0.45 0">
          <a-plane color="#2d2d2d" width="6" height="3.2" position="0 0 -0.1" material="shader: flat"></a-plane>

          <a-entity id="panels-scroller-anchor" clip-updater>
            <!-- HOME -->
            <a-entity id="panel-home" class="panel" visible="true">
              <a-entity position="-2.6 1.3 0"><a-plane color="#4e9a06" width="0.1" height="0.4" position="-0.1 0 0"></a-plane><a-text value="THE ART OF THE PIXEL" align="left" position="0.1 0 0" color="#e9b96e" width="5" font="monoid"></a-text></a-entity>
              <a-text value="Redactedcraft is an experimental voxel project focused on performance and aesthetic clarity. Built from scratch in C# using MonoGame." align="center" position="0 0.8 0" color="#f0f0f0" width="5.2" wrap-count="60" font="monoid"></a-text>
              <a-entity position="0 -0.3 0">
                 <a-entity position="-1.8 0 0"><a-plane color="#111" width="1.6" height="1.4"></a-plane><a-text value="INFINITE TERRAIN" align="center" position="0 0.5 0.01" color="#e9b96e" width="3" font="monoid"></a-text><a-text value="Procedural noise generation." align="center" position="0 -0.1 0.01" color="#ccc" width="2.4" font="monoid"></a-text></a-entity>
                 <a-entity position="0 0 0"><a-plane color="#111" width="1.6" height="1.4"></a-plane><a-text value="GREEDY MESHING" align="center" position="0 0.5 0.01" color="#e9b96e" width="3" font="monoid"></a-text><a-text value="Optimized GPU rendering." align="center" position="0 -0.1 0.01" color="#ccc" width="2.4" font="monoid"></a-text></a-entity>
                 <a-entity position="1.8 0 0"><a-plane color="#111" width="1.6" height="1.4"></a-plane><a-text value="EOS MULTIPLAYER" align="center" position="0 0.5 0.01" color="#e9b96e" width="3" font="monoid"></a-text><a-text value="Robust P2P networking." align="center" position="0 -0.1 0.01" color="#ccc" width="2.4" font="monoid"></a-text></a-entity>
              </a-entity>
              <a-entity class="clickable" position="0 -1.3 0" geometry="primitive: plane; width: 3; height: 0.35" material="color: #4e9a06" onclick="window.open('https://github.com/Redactedcraft/Redactedcraft/releases/latest', '_blank')"><a-text value="DOWNLOAD GAME" align="center" color="#fff" width="4" font="monoid"></a-text></a-entity>
            </a-entity>

            <!-- TEXTURES -->
            <a-entity id="panel-assets" class="panel" visible="false">
              <a-entity id="block-grid" position="-1.5 0 0"></a-entity>
              <a-entity id="inspector" position="1.6 -0.1 0">
                <a-plane color="#111" width="2.4" height="2.6" position="0 0 -0.05"></a-plane>
                <a-text id="ins-name" value="GRASS" align="center" position="0 1.1 0.01" color="#e9b96e" width="4" font="monoid"></a-text>
                <a-entity id="ins-block-parent" position="0 0.1 0.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"><a-entity id="ins-block" voxel-block="src: ../assets/img/grass.png; size: 1"></a-entity></a-entity>
                <a-text id="ins-desc" value="Lush greenery for the surface layer." align="center" position="0 -1 0.01" color="#ccc" width="2.8" wrap-count="35" font="monoid"></a-text>
              </a-entity>
            </a-entity>

            <!-- DEV LOG -->
            <a-entity id="panel-coding" class="panel" visible="false">
              <a-entity id="log-viewport" position="0 0.2 0">
                 <a-entity id="log-scroller">
                   <a-entity id="log-banner-container" position="0 0.8 0.01">
                      <!-- Banner using the custom clipped shader -->
                      <a-plane id="log-banner" width="4" height="1.5" material="shader: ui-clipped; src: #screenshots-bg; transparent: true;" pixelated visible="false"></a-plane>
                   </a-entity>
                   <a-entity id="log-content-parent" position="-2.6 -0.2 0.01"></a-entity>
                 </a-entity>
              </a-entity>
              <!-- Scroll Buttons -->
              <a-entity id="scroll-ui" position="2.7 0 0.3">
                <a-entity class="clickable scroll-btn" data-dir="1" position="0 0.4 0" geometry="primitive: triangle; vertexA: 0 0.12 0; vertexB: -0.12 -0.12 0; vertexC: 0.12 -0.12 0" material="color: #4e9a06; shader: flat"></a-entity>
                <a-entity class="clickable scroll-btn" data-dir="-1" position="0 -0.4 0" geometry="primitive: triangle; vertexA: 0 -0.12 0; vertexB: 0.12 0.12 0; vertexC: -0.12 0.12 0" material="color: #4e9a06; shader: flat"></a-entity>
              </a-entity>
            </a-entity>

            <!-- ABOUT -->
            <a-entity id="panel-about" class="panel" visible="false">
              <a-entity position="-2.6 1.3 0"><a-plane color="#4e9a06" width="0.1" height="0.4" position="-0.1 0 0"></a-plane><a-text value="SOLO DEVELOPMENT" align="left" position="0.1 0 0" color="#e9b96e" width="5" font="monoid"></a-text></a-entity>
              <a-text value="Redactedcraft is a passion project developed entirely solo. The goal is to build a modern, high-performance foundation for voxel games that respects the retro aesthetic." align="center" position="0 0.2 0" color="#f0f0f0" width="5" wrap-count="50" font="monoid"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      const textures = [
          { id: 'grass', name: 'GRASS', desc: 'Lush greenery for the surface layer.' },
          { id: 'dirt', name: 'DIRT', desc: 'Standard soil found beneath the grass.' },
          { id: 'stone', name: 'STONE', desc: 'Dense rock forming the world\'s crust.' },
          { id: 'sand', name: 'SAND', desc: 'Fine grains found in deserts and beaches.' },
          { id: 'wood', name: 'WOOD', desc: 'Raw timber harvested from trees.' },
          { id: 'leaves', name: 'LEAVES', desc: 'Translucent foliage from the canopy.' },
          { id: 'water', name: 'WATER', desc: 'Fluid life-giving substance of the oceans.' },
          { id: 'diamond', name: 'DIAMOND', desc: 'The hardest and most precious material.' },
          { id: 'iron', name: 'IRON', desc: 'Essential metal for durable equipment.' },
          { id: 'gold', name: 'GOLD', desc: 'Rare, heavy metal for the elite.' },
          { id: 'plank', name: 'PLANK', desc: 'Refined wood for building structures.' },
          { id: 'glass', name: 'GLASS', desc: 'Smelted sand, perfect for windows.' }
      ];

      const logs = {
        game: [
          { title: "âš¡ RedactedCraft v0.1.2 â€” EOS Recovery", body: "Resolved race conditions in EOS initialization. Improved multiplayer reliability via dynamic polling, async connection logic, and automatic session recovery." },
          { title: "ðŸ”§ Engine: Infrastructure & SDK Cleanup", body: "Standardized network traffic via dedicated service proxy. Implemented local-to-remote credential fallback and optimized SDK binary footprint." },
          { title: "ðŸ› ï¸ Developer Update: Unified Build Pipeline", body: "Revolutionized workflow with a new Unified Build GUI. Support for automated single-file publishing and simplified source distribution." },
          { title: "ðŸ§¹ Launcher: Distribution & Sync Logic", body: "Refined asset synchronization protocol. Improved skip logic via checksum verification and removed deprecated atlas requirements." },
          { title: "ðŸ“¡ Multiplayer: EOS Integration Phase I", body: "Completed core Epic Online Services integration. Enabled cross-platform P2P networking, friend lists, and host codes." },
          { title: "ðŸ—ºï¸ World: Advanced Greedy Meshing", body: "Implemented optimized meshing algorithm. Reduces draw calls by 400% via quad-merging adjacent voxel faces." },
          { title: "ðŸš€ Project Start: MonoGame Architecture", body: "Transitioned to modern C# foundation. Superior thread safety and robust asset pipeline for future voxel generation." }
        ],
        website: [
          { title: "ðŸ¥½ WebXR: Immersive VR Portal Launch", body: "Launched experimental WebXR kiosk. Quest 2/3 users can now explore virtual voxel spaces directly from the portal." },
          { title: "ðŸ“± UX: Touch-Optimized 3D Inspection", body: "Implemented touch-and-drag gesture support for 3D model rotation. Achieved full feature parity for mobile environments." },
          { title: "âš–ï¸ Legal: Privacy & Terms Implementation", body: "Added essential transparency pages regarding EOS data handling and legal compliance." },
          { title: "ðŸ–¼ï¸ Asset Browser: Massive UI Overhaul", body: "Upgraded texture viewer with 512px pixel-perfect previews and integrated creator download triggers." },
          { title: "ðŸ” Engine: Three.js Model Inspector", body: "Integrated real-time web-based 3D viewer. Utilizes engine UV mapping logic for accurate block design previews." }
        ]
      };

      function renderLogs(type) {
        const container = document.getElementById('log-content-parent');
        container.innerHTML = '';
        let offset = 0;
        logs[type].forEach(log => {
          const entry = document.createElement('a-entity');
          entry.setAttribute('position', `0 ${offset} 0`);
          const t = document.createElement('a-text');
          t.setAttribute('value', log.title); t.setAttribute('color', '#e9b96e'); t.setAttribute('width', '5'); t.setAttribute('font', 'monoid');
          t.setAttribute('material', 'shader: ui-clipped; transparent: true;');
          const b = document.createElement('a-text');
          b.setAttribute('value', log.body); b.setAttribute('position', '0.2 -0.4 0'); b.setAttribute('color', '#ccc'); b.setAttribute('width', '4.5'); b.setAttribute('font', 'monoid'); b.setAttribute('wrap-count', '50');
          b.setAttribute('material', 'shader: ui-clipped; transparent: true;');
          entry.appendChild(t); entry.appendChild(b); container.appendChild(entry);
          offset -= 1.2;
        });
      }

      const grid = document.getElementById('block-grid');
      textures.forEach((b, i) => {
        const x = (i % 4) * 0.72 - 1.08, y = Math.floor(i / 4) * -0.72 + 0.6;
        const btn = document.createElement('a-entity');
        btn.setAttribute('position', `${x} ${y} 0.02`);
        btn.setAttribute('class', 'clickable block-btn');
        const p = document.createElement('a-plane');
        p.setAttribute('width', '0.65'); p.setAttribute('height', '0.65');
        p.setAttribute('material', 'color: #333; shader: flat');
        const img = document.createElement('a-image');
        img.setAttribute('src', `../assets/img/${b.id}.png`);
        img.setAttribute('width', '0.55'); img.setAttribute('height', '0.55');
        img.setAttribute('position', '0 0 0.01'); img.setAttribute('pixelated', '');
        btn.appendChild(p); btn.appendChild(img); grid.appendChild(btn);
        btn.addEventListener('click', () => {
          document.getElementById('ins-name').setAttribute('value', b.name);
          document.getElementById('ins-desc').setAttribute('value', b.desc);
          document.getElementById('ins-block').setAttribute('voxel-block', 'src', `../assets/img/${b.id}.png`);
        });
      });

      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const target = btn.getAttribute('data-target');
          document.querySelectorAll('.nav-btn').forEach(b => b.setAttribute('material', 'color', '#333'));
          btn.setAttribute('material', 'color', '#4e9a06');
          document.querySelectorAll('.panel').forEach(p => p.setAttribute('visible', 'false'));
          document.getElementById('panel-' + target).setAttribute('visible', 'true');
        });
      });

      document.querySelectorAll('.sub-nav-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.sub-nav-btn').forEach(b => b.setAttribute('material', 'color', '#333'));
          btn.setAttribute('material', 'color', '#4e9a06');
          renderLogs(btn.getAttribute('data-log'));
          document.getElementById('log-banner').setAttribute('visible', btn.getAttribute('data-log') === 'game');
          scrollY = 0; applyScroll(0);
        });
      });
      renderLogs('game');

      document.querySelectorAll('.scroll-btn').forEach(btn => btn.addEventListener('click', () => applyScroll(parseInt(btn.getAttribute('data-dir')))));
      window.addEventListener('wheel', (e) => { if (document.getElementById('panel-coding').getAttribute('visible')) applyScroll(e.deltaY > 0 ? 0.2 : -0.2); });
      document.body.addEventListener('click', () => { if (!document.querySelector('a-scene').is('vr-mode')) document.querySelector('a-scene').canvas.requestPointerLock(); });

      document.querySelectorAll('.clickable').forEach(el => {
        el.addEventListener('click', () => {
          const clickAttr = el.getAttribute('onclick');
          if (clickAttr && clickAttr.includes('window')) {
             const url = clickAttr.match(/'([^']+)'/)[1];
             if (clickAttr.includes('open')) window.open(url, '_blank'); else window.location.href = url;
          }
        });
      });
    </script>
  </body>
</html>